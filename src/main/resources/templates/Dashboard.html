<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <title>Dashboard</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="Home.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"
            integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
            integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
            crossorigin="anonymous"></script>

</head>
<body>
<div class="container-fluid">
    <div class="row">

        <!--  Header Text -->
        <div class="col-md-12 mb-2">
            <div class="row">
                <nav class="navbar navbar-light bg-light col-md-12" style="border: 1px solid; border-radius: 7px">
                    <div>
                        <img src="myLogo.png" alt="logo unavailable"
                             style="height: 40px; width: 40px">
                        <a class="navbar-brand" href="#">
                            Link Sharing
                        </a>
                    </div>
                    <!-- Search form -->
                    <div class="search" style="float: right">
                        <span style="margin-bottom:12px" class="fa fa-search"></span>
                        <input placeholder="Search term">
                        <span class="fa fa-times"></span>
                    </div>

                    <!--all icons-->
                    <div style="float: right">
                        <span style="margin-bottom:12px" class="fa fa-comment fa-lg" data-toggle="modal"
                              data-target="#createTopicModal"></span>
                        <span style="margin-bottom:12px" class="fa fa-envelope-o fa-lg" data-toggle="modal"
                              data-target="#sendInvitationModal"></span>
                        <span style="margin-bottom:12px" class="fa fa-link fa-lg" data-toggle="modal"
                              data-target="#shareLinkModal"></span>
                        <span style="margin-bottom:12px" class="fa fa-file-o fa-lg" data-toggle="modal"
                              data-target="#shareDocumentModal"></span>
                    </div>

                    <!--user icon and drop down-->
                    <div style="float: right" class="dropdown show">
                        <span style="margin-bottom:12px" class="fa fa-user fa-lg"></span>
                        <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Uday
                        </a>

                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            <a class="dropdown-item" href="#">Profile</a>
                            <a class="dropdown-item" href="#">Users</a>
                            <a class="dropdown-item" href="/logout">Logout</a>
                        </div>
                    </div>

                    <!-- Send Invitation Modal -->
                    <div class="modal fade" id="sendInvitationModal" tabindex="-1" role="dialog"
                         aria-labelledby="exampleModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Send Invitation</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Email*</label>
                                            <div class="col-md-7">
                                                <input type="text" class="form-control" id="email" placeholder="email"
                                                       required="">
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Topic*</label>
                                            <div class="col-md-7">
                                                <input type="text" class="form-control" id="topic" placeholder="topic"
                                                       required="">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-primary">Invite</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Create Topic Modal -->
                    <div class="modal fade" id="createTopicModal" tabindex="-1" role="dialog"
                         aria-labelledby="createTopicModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="createTopicModalLabel">Create Topic</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <form method="post" th:action="@{/dashboard/createTopic}" th:object="${topic}">
                                    <div class="modal-body">
                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Name*</label>
                                            <div class="col-md-7">
                                                <input type="text" class="form-control" id="name" placeholder="name"
                                                       th:field="*{name}" required="">
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Visibility*</label>
                                            <div class="col-md-7">
                                                <select th:field="*{visibility}"
                                                        class="browser-default custom-select m-2">
                                                    <option th:each="visibility : ${T(com.ttn.linksharing.enums.Visibility).values()}"
                                                            th:value="${visibility}" th:text="${visibility}"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel
                                        </button>
                                        <input type="submit" class="btn btn-primary createTopicButton">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Share Link Modal -->
                    <div class="modal fade" id="shareLinkModal" tabindex="-1" role="dialog"
                         aria-labelledby="shareLinkModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="shareLinkModalLabel">Share Link</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="usrform" method="post" th:action="@{/dashboard/shareLink}"
                                          th:object="${linkResource}">
                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Link*</label>
                                            <div class="col-md-7">
                                                <input type="text" class="form-control" id="Link" placeholder="Link"
                                                       th:field="*{url}" required="">
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Description*</label>
                                            <div class="col-md-7">
                                                <textarea class="form-control" id="exampleFormControlTextarea1"
                                                          th:field="*{description}" rows="3">Description</textarea>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Topic*</label>
                                            <div class="col-md-7">
                                                <select class="browser-default custom-select m-2"
                                                        th:field="*{topic.id}">
                                                    <option th:each="topic : ${topics}"
                                                            th:value="${topic.id}" th:text="${topic.name}"></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                Cancel
                                            </button>
                                            <input type="submit" class="btn btn-primary">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Share Document Modal -->
                    <div class="modal fade" id="shareDocumentModal" tabindex="-1" role="dialog"
                         aria-labelledby="shareDocumentModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="shareDocumentModalLabel">Share Document</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form method="post" th:action="@{/dashboard/shareDocument}"
                                          th:object="${documentResource}" enctype="multipart/form-data">
                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Document*</label>
                                            <div class="col-md-7">
                                                <div class="input-group">
                                                    <input type="file" id="file" name="file" class="form-control">
                                                    <p th:if="${#fields.hasErrors('path')}" th:errors="*{path}"
                                                       class="alert alert-danger"/>
                                                </div><!-- /input-group -->
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Description*</label>
                                            <div class="col-md-7">
                                                <textarea class="form-control" id="exampleFormControlTextarea"
                                                          th:field="*{description}" rows="3">Description</textarea>
                                            </div>
                                        </div>


                                        <div class="form-group row">
                                            <label class="col-md-5 col-form-label">Topic*</label>
                                            <div class="col-md-7">
                                                <select class="browser-default custom-select m-2"
                                                        th:field="*{topic.id}">
                                                    <option th:each="topic : ${topics}"
                                                            th:value="${topic.id}" th:text="${topic.name}"></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                Cancel
                                            </button>
                                            <input type="submit" value="Share" class="btn btn-primary">
                                        </div>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>


                </nav>
            </div>
        </div>

        <!--body in between left content-->
        <div class="col-md-5">
            <div class="card" m-2>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <img src="username.png" alt="user image"
                                 style="border: 1px solid;height: 140px; width: 140px">
                        </div>
                        <div class="col-md-8">

                            <h5 class="card-title" th:text="${name}"></h5>
                            <p class="card-text">
                                <span>Subscriptions: </span>
                                <a href="#" id="subscriptionsCount"
                                   th:text="${countSub}"></a><br>
                                <span>Topics: </span>
                                <a href="#" id="topicsCount" th:text="${countTop}"></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card m-2">
                <h5 class="card-header">Subscriptions<span style="float: right"></span></h5>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" th:id="${subscription.topic.id}+'subscriptionBox'" th:each="subscription : ${subscriptions}">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="username.png" alt="user image"
                                         style="border: 1px solid;height: 140px; width: 140px">
                                </div>
                                <div class="col-md-8">
                                    <h5 class="card-title subscriptionTopicNameOriginal"
                                        th:id="${subscription.topic.id}+'subscriptionTopicNameOriginal'"
                                        th:text="${subscription.topic.name}"></h5>
                                    <h5 class="card-title subscriptionTopicName" style="display: none"
                                        th:id="${subscription.topic.id}+'subscriptionTopicName'">
                                        <input type="text" th:id="${subscription.topic.id}+'subscriptionTopicText'"
                                               th:value="${subscription.topic.name}">
                                        <span class="input-group-btn">
                                                       <button class="btn btn-outline-primary subscriptionTopicSave"
                                                               th:attr="data-topic_id=${subscription.topic.id}"
                                                               type="button">Save</button>
                                        </span>
                                        <span class="input-group-btn">
                                        <button class="btn btn-outline-primary subscriptionTopicCancel"
                                                th:attr="data-topic_id=${subscription.topic.id}"
                                                type="button">Cancel</button>
                                        </span>
                                    </h5>
                                    <div style="display: inline-block">
                                        <p class="card-text">
                                            <span>Subscriptions: </span>
                                            <a href="#" class="subscriptionsCount"
                                               th:text="${subscription.topic.subscriptions.size()}"></a><br>
                                            <span>Post: </span>
                                            <a href="#" class="topicsCount"
                                               th:text="${subscription.topic.resource.size()}"></a>
                                            <br>
                                            <span><a href="#">Unsubscribe</a></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <select th:attr="data-subscription_id=${subscription.id}"
                                            class="browser-default custom-select m-2 seriousnessDropDown">
                                        <option th:each="seriousness : ${T(com.ttn.linksharing.enums.Seriousness).values()}"
                                                th:value="${seriousness}" th:text="${seriousness}"
                                                th:selected="${seriousness==subscription.seriousness}"></option>
                                    </select>
                                </div>
                                <div class="col-md-4" th:if="${subscription.topic.user.id == user.id}">
                                    <select th:attr="data-topic_id=${subscription.topic.id}"
                                            class="browser-default custom-select m-2 visibilityDropDown">
                                        <option th:each="visibility : ${T(com.ttn.linksharing.enums.Visibility).values()}"
                                                th:value="${visibility}" th:text="${visibility}"
                                                th:selected="${visibility==subscription.topic.visibility}"></option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <i class="fa fa-envelope-o pt-3 pb-3 pl-3"></i>
                                    <i class="fa fa-pencil-square-o pt-3 pb-3 pl-3 subscriptionTopicEdit"
                                       th:if="${subscription.topic.user.id == user.id}"
                                       th:attr="data-el_id=${subscription.topic.id}"></i>
                                    <i class="fa fa-trash-o pt-3 pb-3 pl-3 subscriptionTopicDelete"
                                       th:if="${subscription.topic.user.id == user.id}"
                                       th:attr="data-topic_id=${subscription.topic.id}"></i>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="card m-2">
                <h5 class="card-header">Trending Topics</h5>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" th:each="topic : ${trendingTopics}">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="username.png" alt="user image"
                                         style="border: 1px solid;height: 140px; width: 140px">
                                </div>
                                <div class="col-md-8">
                                    <h5 class="card-title" th:text="${topic.name}"></h5>
                                    <div style="display: inline-block">
                                        <p class="card-text">
                                            <span>Subscriptions: </span>
                                            <a href="#" class="subscriptionsCount"
                                               th:text="${topic.subscriptions.size()}"></a><br>
                                            <span>Post: </span>
                                            <a href="#" class="topicsCount"
                                               th:text="${topic.resource.size()}"></a>
                                            <br>
                                            <span>
                                                <a href="#" class="trendingTopicUnsubscribe">Unsubscribe</a>
                                                <a href="#" class="trendingTopicSubscribe">Subscribe</a>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="browser-default custom-select m-2">
                                        <option selected value="1">Serious</option>
                                        <option value="2">Very Serious</option>
                                        <option value="3">Casual</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="browser-default custom-select m-2">
                                        <option selected value="1">Private</option>
                                        <option value="2">Edit</option>
                                        <option value="3">Delete</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <i class="fa fa-envelope-o pt-3 pb-3 pl-3"></i>
                                    <i class="fa fa-pencil-square-o pt-3 pb-3 pl-3"></i>
                                    <i class="fa fa-trash-o pt-3 pb-3 pl-3"></i>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>


        <!--body in between right content-->
        <div class="col-md-7">
            <div class="card m-2">
                <h5 class="card-header">Inbox<span style="float: right"><a href="#">View All</a> </span></h5>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="username.png" alt="user image"
                                         style="border: 1px solid;height: 140px; width: 140px">
                                </div>
                                <div class="col-md-8">
                                    <h5 class="card-title" th:object="${user}" th:text="${name}"></h5>
                                    <div style="display: inline-block">
                                        <p class="card-text">
                                            lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor
                                            lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor
                                            lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="float: right">
                                <a href="#" class="mr-4">Download</a>
                                <a href="#" class="mr-4">View Full Site</a>
                                <a href="#" class="mr-4">Mark as Read</a>
                                <a href="#">View Post</a>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="username.png" alt="user image"
                                         style="border: 1px solid;height: 140px; width: 140px">
                                </div>
                                <div class="col-md-8">
                                    <h5 class="card-title" th:object="${user}" th:text="${name}"></h5>
                                    <div style="display: inline-block">
                                        <p class="card-text">
                                            lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor
                                            lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor
                                            lorem ipsum dolor lorem ipsum dolor lorem ipsum dolor
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="float: right">
                                <a href="#" class="mr-4">Download</a>
                                <a href="#" class="mr-4">View Full Site</a>
                                <a href="#" class="mr-4">Mark as Read</a>
                                <a href="#">View Post</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $(".createTopicButton").click(function () {
            alert("The topic has been created successfully!");
        });

        $(".subscriptionTopicDelete").click(function () {
            var y = $(this).attr("data-topic_id").concat("subscriptionBox");
            $("#" + y).css('display', 'none');

            var topicId = $(this).attr("data-topic_id");

            $.ajax({
                type: "POST",
                url: "/deleteSubscription",
                data: {topicId: topicId},
                datatype: JSON,
                success: function (data) {
                    if (data.SUCCESS != null){
                        location.reload();
                        alert(data.SUCCESS);}
                    else
                        alert(data.ERROR);
                }
            });
        });

        $(".subscriptionTopicEdit").click(function () {
            var y = $(this).attr("data-el_id").concat("subscriptionTopicNameOriginal");
            $("#" + y).css('display', 'none');

            var x = $(this).attr("data-el_id").concat("subscriptionTopicName");
            $("#" + x).css('display', 'block');
        });

        $(".subscriptionTopicCancel").click(function () {
            var y = $(this).attr("data-topic_id").concat("subscriptionTopicNameOriginal");
            $("#" + y).css('display', 'block');

            var x = $(this).attr("data-topic_id").concat("subscriptionTopicName");
            $("#" + x).css('display', 'none');
        });

        $(".subscriptionTopicSave").click(function () {
            var topicId = $(this).attr("data-topic_id");
            var topicName = $("#" + topicId + "subscriptionTopicText").val();
            var y = $(this).attr("data-topic_id").concat("subscriptionTopicNameOriginal");
            $("#" + y).css('display', 'block');

            var x = $(this).attr("data-topic_id").concat("subscriptionTopicName");
            $("#" + x).css('display', 'none');

            $.ajax({
                type: "POST",
                url: "/updateTopicName",
                data: {topicId: topicId, topicName: topicName},
                datatype: JSON,
                success: function (data) {
                    if (data.SUCCESS != null){
                        location.reload();
                        alert(data.SUCCESS);}
                    else
                        alert(data.ERROR);
                }
            });
        });

        $(".seriousnessDropDown").change(function () {
            var subscriptionId = $(this).attr("data-subscription_id");
            var seriousness = $(this).val();
            $.ajax({
                type: "POST",
                url: "/updateSeriousness",
                data: {subscriptionId: subscriptionId, seriousness: seriousness},
                datatype: JSON,
                success: function (data) {
                    if (data.SUCCESS != null)
                        alert(data.SUCCESS);
                    else
                        alert(data.ERROR);
                }
            });
        });

        $(".visibilityDropDown").change(function () {
            var topicId = $(this).attr("data-topic_id");
            var visibility = $(this).val();
            $.ajax({
                type: "POST",
                url: "/updateVisibility",
                data: {topicId: topicId, visibility: visibility},
                datatype: JSON,
                success: function (data) {
                    if (data.SUCCESS != null)
                        alert(data.SUCCESS);
                    else
                        alert(data.ERROR);
                }
            });
        });
    });
</script>
</body>
</html>